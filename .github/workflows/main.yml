name: Try Trivy

on:
  push:
    branches:
      - main

jobs:
  build:
    name: Build
    runs-on: ubuntu-20.04
    steps:
      # - name: Checkout code
      #   uses: actions/checkout@v2
      # - name: Build an image from dockerfile
      #   run: |
      #     docker build . -t angular-toh
      - name: Pull pre-vulnerable image from Vulnix
        run: |
          docker pull ghcr.io/vulnix/vulnerability-db:latest
      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'angular-toh'
          format: 'table'
          exit-code: '1'
          ignore-unfixed: true
          vuln-type: 'testdata'
          severity: 'CRITICAL,HIGH'
